<!DOCTYPE html>
<html>
<head>
  <title>Genesys SDK Context Test Widget</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .label { font-weight: bold; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 4px; }
  </style>
  <script src="https://sdk-cdn.mypurecloud.com/client-apps/2.6.3/purecloud-client-app-sdk-de77761d.min.js"></script>
</head>
<body>
  <h1>Genesys SDK Context Test Widget</h1>
  <div>
    <p><span class="label">Conversation ID:</span> <span id="convId">Loading...</span></p>
    <p><span class="label">Host Origin:</span> <span id="hostOrigin">Loading...</span></p>
    <p><span class="label">Target Environment:</span> <span id="targetEnv">Loading...</span></p>
    <p><span class="label">User ID:</span> <span id="userId">Loading...</span></p>
    <p><span class="label">User Name:</span> <span id="userName">Loading...</span></p>
  </div>
  <h2>Full Context Object (JSON):</h2>
  <pre id="fullContext">Loading...</pre>

  <script>
    (function() {
      const clientApp = new purecloud.apps.ClientApp();

      function safeGet(obj, path, defaultVal = null) {
        return path.reduce((acc, key) => (acc && acc[key] !== undefined) ? acc[key] : defaultVal, obj);
      }

      // Helper to update element text
      function setText(id, text) {
        document.getElementById(id).textContent = text !== null ? text : 'null';
      }

      // Get context and update UI
      function updateContext() {
        clientApp.context.getCurrent().then(context => {
          // Show JSON
          document.getElementById('fullContext').textContent = JSON.stringify(context, null, 2);

          // Extract values or fallback to null
          const convId = safeGet(context, ['conversationId']) || 
                         safeGet(context, ['interaction', 'conversation', 'id']) ||
                         safeGet(context, ['interaction', 'conversationId']) ||
                         null;

          const hostOrigin = safeGet(context, ['hostOrigin']) || null;
          const targetEnv = safeGet(context, ['targetEnvironment']) || null;
          const userId = safeGet(context, ['user', 'id']) || null;
          const userName = safeGet(context, ['user', 'name']) || null;

          setText('convId', convId);
          setText('hostOrigin', hostOrigin);
          setText('targetEnv', targetEnv);
          setText('userId', userId);
          setText('userName', userName);
        }).catch(err => {
          console.error('Error fetching context:', err);
          document.getElementById('fullContext').textContent = 'Error fetching context.';
          setText('convId', 'null');
          setText('hostOrigin', 'null');
          setText('targetEnv', 'null');
          setText('userId', 'null');
          setText('userName', 'null');
        });
      }

      // Initial update
      updateContext();

      // Also update on context change
      clientApp.context.on('change', updateContext);
    })();
  </script>
</body>
</html>
